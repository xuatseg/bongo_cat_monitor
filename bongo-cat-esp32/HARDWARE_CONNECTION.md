# 硬件连接图

## ESP32 与触摸屏/显示屏连接

```
ESP32 Dev Board          ILI9341 显示屏        STMPE610 触摸屏
┌─────────────┐         ┌─────────────┐      ┌─────────────┐
│             │         │             │      │             │
│  GPIO 14 ───┼─────────┼─ SCL        │      │ SCL ────────┼── GPIO 14
│             │         │             │      │             │
│  GPIO 13 ───┼─────────┼─ SDA        │      │ SDA ────────┼── GPIO 13
│             │         │             │      │             │
│  GPIO 15 ───┼─────────┼─ CS         │      │             │
│             │         │             │      │             │
│  GPIO 2  ───┼─────────┼─ DC         │      │             │
│             │         │             │      │             │
│  GPIO 27 ───┼─────────┼─ BL         │      │             │
│             │         │             │      │             │
│             │         │             │      │ CS ─────────┼── GPIO 33
│             │         │             │      │             │
│  3.3V   ────┼─────────┼─ VCC        │      │ VCC ────────┼── 3.3V
│             │         │             │      │             │
│  GND   ─────┼─────────┼─ GND        │      │ GND ────────┼── GND
│             │         │             │      │             │
└─────────────┘         └─────────────┘      └─────────────┘
```

## 引脚分配表

| 功能 | ESP32引脚 | 显示屏引脚 | 触摸屏引脚 | 说明 |
|------|-----------|------------|------------|------|
| SPI时钟 | GPIO 14 | SCL | SCL | 共享SPI时钟 |
| SPI数据 | GPIO 13 | SDA | SDA | 共享SPI数据 |
| 显示屏片选 | GPIO 15 | CS | - | 显示屏选择 |
| 触摸屏片选 | GPIO 33 | - | CS | 触摸屏选择 |
| 数据/命令 | GPIO 2 | DC | - | 显示屏控制 |
| 背光控制 | GPIO 27 | BL | - | 背光开关 |
| 电源正极 | 3.3V | VCC | VCC | 3.3V电源 |
| 电源负极 | GND | GND | GND | 地线 |

## 连接注意事项

### 电源连接
- 确保所有设备都连接到3.3V电源
- 不要使用5V，可能会损坏设备
- 建议使用外部电源，避免USB供电不足

### SPI连接
- 显示屏和触摸屏共享SPI总线
- 通过不同的CS引脚进行设备选择
- 确保SPI引脚连接正确

### 触摸屏特殊要求
- STMPE610需要较低的SPI频率 (2.5MHz)
- 代码中已配置专用触摸屏SPI频率
- 确保CS引脚连接正确

## 测试连接

### 1. 基本连接测试
```bash
# 编译并上传代码
pio run -t upload

# 监控串口输出
pio device monitor
```

### 2. 触摸屏测试
```bash
# 使用测试脚本
python3 test_touch.py
```

### 3. 预期输出
```
🔘 Initializing touch screen...
✅ Touch screen initialized successfully!
✅ Bongo Cat Ready!
🔘 Touch: X=120, Y=160 (Raw: 2048, 2048, Pressure: 512)
```

## 故障排除

### 显示屏无显示
- 检查电源连接 (3.3V, GND)
- 检查SPI连接 (SCL, SDA, CS, DC)
- 检查背光控制 (BL引脚)

### 触摸屏无响应
- 检查触摸屏电源连接
- 检查SPI连接 (SCL, SDA, CS)
- 确认CS引脚配置正确 (GPIO 33)

### 坐标不准确
- 触摸屏可能需要校准
- 检查坐标映射参数
- 确认屏幕方向设置

## 硬件要求

### 必需组件
- ESP32开发板
- ILI9341 2.4寸显示屏 (240x320)
- STMPE610 触摸控制器
- 杜邦线若干
- 面包板 (可选)

### 可选组件
- 外部电源模块
- 显示屏保护壳
- 触摸屏保护膜
